# Отчет о тестировании поведения распределения виртуальной и физической памяти
Проверяем влияния различных режимов доступа (чтение/запись) на занимаемый объем физической памяти при распределении памяти с использованием функции `malloc()`. Тестирование проводилось в сравнительном режиме: в среде Linux и в имитационной среде Windows, запущенной через Wine.
#### Аппаратная среда
 - CPU: 11th Gen Intel(R) Core(TM) i5-11400H @ 2.70GHz (2.69 GHz)
 
 - memory: 16GiB

# Шаги
1.Запускать программу соответственно в режимах `r` (чтение) и `w` (запись)

2.Наблюдать за состоянием использования памяти в инструменте мониторинга системы

3.Записывать изменения физической памяти и виртуальной памяти

4.Приостанавливать процесс после каждого распределения 128 MiB памяти и фиксировать полученные результаты наблюдения

- Размер страницы: 4 КБ

- Шаг распределения: 128 МБ

- Настройка задержки: 100 микросекунд на доступ к странице

- Максимальное распределение: 4 ГБ


# Результаты тестирования системы Linux
>  Ubuntu 24.04.1 LTS

Напишем shell-скрипт для отслеживания изменений в виртуальной и физической памяти в режиме реального времени!!(memory.sh)

### Read

Запустить нашу программу после запуска скрипта

```shell
 ./memory.sh
 ```

```shell
./memory_test r
```

![image Alt](a.png)

![image Alt](b.png)

##### Write

```shell
 ./memory.sh
```

```shell
./memory_test w
```

![](c.png)
![](d.png)
![](e.png)

#### Результаты тестирования системы Windows через Wine

> Windows 11

Точно так же напишем shell-скрипт для отслеживания изменений в виртуальной и физической памяти в режиме реального времени!!([wine_monitor.sh](wine_monitor.sh))

##### Read

Компиляция исполняемых файлов Windows в Linux:

```shell
 x86_64-w64-mingw32-gcc -o memory_test.exe memory.c
```

Запустить нашу программу после запуска скрипта

```shell
./wine_monitor.sh
```

```shell
 wine ./memory_test.exe r
```

![](https://github.com/chef123-bot/virtual-memory/blob/33c40732ff82336e1a2ffa9f5d854acb9c794eda/f.png)
![](https://github.com/chef123-bot/virtual-memory/blob/33c40732ff82336e1a2ffa9f5d854acb9c794eda/g.png)

Программа работает очень медленно в системе Windows, эмулируемой через Wine

##### Write

```shell
./wine_monitor.sh
```

```shell
 wine ./memory_test.exe w
```

![](https://github.com/chef123-bot/virtual-memory/blob/33c40732ff82336e1a2ffa9f5d854acb9c794eda/h.png)
![](https://github.com/chef123-bot/virtual-memory/blob/33c40732ff82336e1a2ffa9f5d854acb9c794eda/i.png)

#### Вывод 

##### 1. **Поведение в среде Linux**

- Режим `r`:Виртуальная память растет согласно ожиданиям (на 128 MiB каждый раз), но физическая память практически не изменяется. Причина: в Linux функция `malloc` только предварительно выделяет виртуальное адресное пространство, но не выполняет фактическое отображение физической памяти; операция «чтения неинициализированной памяти» не запускает распределение физической памяти.
- Режим `w`  :Виртуальная память также продолжает расти на 128 MiB, однако физическая память постепенно увеличивается вместе с операциями записи.

##### 2. **Поведение в эмулированной среде Windows (через Wine)**

- Режимы `r`/`w` :

  Виртуальная память также увеличивается с шагом +128 МиБ, но потребление физической памяти более «агрессивное» по сравнению с нативным Linux — даже в режиме r физическая память незначительно растёт. 

  Причина: особенности логики эмуляции модели памяти Windows в Wine или более строгая обработка операций «доступа к неинициализированной памяти» самой Windows (даже операция чтения может запустить отображение физической памяти).


##### 3. Итоги:

- Выделение виртуальной памяти: Функция `malloc` немедленно резервирует область в виртуальном адресном пространстве процесса, независимо от режима доступа (чтение или запись) и окружения.
- Выделение физической памяти: Операционная система выделяет реальные физические страницы памяти только в момент фактической записи данных программой. Если происходит лишь чтение неинициализированной памяти, значительного роста потребления физической памяти не наблюдается.
- Сравнение Wine и Linux: В среде Wine рост потребления физической памяти проявляется более явно. Это демонстрирует различия в стратегиях управления и отображения памяти между нативной операционной системой (Linux) и эмуляционным слоем (Wine).
